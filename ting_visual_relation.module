<?php

/**
 * @file
 *
 * Module file for the Ting visual relation module.
 */

/**
 * Implements hook_field_info().
 */
function ting_visual_relation_field_info() {
	return array(
		'ting_visual_relations' => array(
			'label' => t('Ting visual relations'),
			'description' => t('A field type that adds an acitivator for a visual relation browser.'),
			'default_widget' => 'hidden',
			'default_formatter' => 'ting_visual_relations_default',
			// This is not a generel field intended to be added to any entity. We
			// therefore restrict access by disabling the ability to configure this
			// field from the admin UI.
			'no_ui' => TRUE,
		),
	);
}

/**
 * Implements hook_field_load().
 *
 * Populate the items array with the id of the entities the field is being 
 * loaded on. If we didn't do this, Field API would think that the field is
 * empty and our formatters wouldn't be called.
 */
function ting_visual_relation_field_load($entity_type, $entities, $field, $instances, $langcode, &$items, $age) {
	foreach ($entities as $id => $entity) {
		$items[$id][0] = array('id' => $id);
	}
}

/**
 * Implements hook_widget_info_alter().
 *
 * We implement this hook to add our field type to the list of supported 
 * fields, for the 'hidden' field widget defined in core.
 */
function ting_visual_relation_widget_info_alter(&$info) {
	if (isset($info['hidden'])) {
		$info['hidden']['field types'][] = 'ting_visual_relations';
	}
}

/**
 * Implements hook_field_formatter_info().
 */
function ting_visual_relation_field_formatter_info() {
	return array(
		'ting_visual_relations_default' => array(
			'label' => t('Default'),
			'field types' => array(
				'ting_visual_relations',
			),
		),
	);
}

/**
 * Implements hook_field_formatter_view().
 */
function ting_visual_relation_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
	return array(
		'#theme' => 'html_tag',
		'#tag' => 'span',
		'#value' => t('Browse relations'),
		'#attributes' => array(
			'class' => 'ting-visual-relations-activator',
		),
	);
}


